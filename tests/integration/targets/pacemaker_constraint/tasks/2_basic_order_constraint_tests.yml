---
- name: Check limit on order length
  community.pacemaker.pacemaker_constraint:
    name: startResources
    type: order
    order:
      - start: mounts
      - start: mysql
      - start: httpd
  ignore_errors: false
  register: order

- assert:
    that:
     - order.failed
     - order.msg == "Use the 'pcs constraint order set' command if you want to create a constraint for more than two resources."

- name: Start resources in a specific order (check mode)
  community.pacemaker.pacemaker_constraint:
    name: startResources
    type: order
    order:
      - start: mounts
      - start: mysql
  check_mode: true
  register: order

- assert:
    that: order.changed

- name: Start resources in a specific order
  community.pacemaker.pacemaker_constraint:
    name: startResources
    type: order
    order:
      - start: mounts
      - start: mysql
  register: order

- assert:
    that: order.changed

- name: Start resources in a specific order (again)
  community.pacemaker.pacemaker_constraint:
    name: startResources
    type: order
    order:
      - start: mounts
      - start: mysql
  register: order

- assert:
    that: order.changed == False

- name: Stop resources in a specific order (check mode)
  community.pacemaker.pacemaker_constraint:
    name: stopResources
    type: order
    order:
      - stop: mysql
      - start: mounts
  check_mode: true
  register: order

- assert:
    that: order.changed

- name: Stop resources in a specific order
  community.pacemaker.pacemaker_constraint:
    name: stopResources
    type: order
    order:
      - stop: mysql
      - start: mounts
  register: order

- assert:
    that: order.changed

- name: Stop resources in a specific order (again)
  community.pacemaker.pacemaker_constraint:
    name: stopResources
    type: order
    order:
      - stop: mysql
      - start: mounts
  register: order

- assert:
    that: order.changed == False

- name: Create an ordered set of resources (check mode)
  community.pacemaker.pacemaker_constraint:
    name: resourceSet
    type: order
    set:
      - mounts
      - mysql
      - httpd
  check_mode: true
  register: set

- assert:
    that: set.changed

- name: Create an ordered set of resources
  community.pacemaker.pacemaker_constraint:
    name: resourceSet
    type: order
    set:
      - mounts
      - mysql
      - httpd
  register: set

- assert:
    that: set.changed

- name: Create an ordered set of resources (again)
  community.pacemaker.pacemaker_constraint:
    name: resourceSet
    type: order
    set:
      - mounts
      - mysql
      - httpd
  register: set

- assert:
    that: set.changed == False
